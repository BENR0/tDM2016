
<!-- Aufgabe 3, Korvarianzanalysis -->

# Beschreiben Sie den Wissensgewinn durch diese Modelle. Wie und wodurch wird NO3 beeinflusst?
## Originale Daten
Wir bearbeiten zuerst die Datensätze „Chirimachay_NO3.lrn“ , „Chirimachay_Netradiation.lrn“ und „Chirimachay_Precip.lrn“, so dass die Messgrößen innerhalb 12 Stunden aggregiert werden. Weiterhin werden nur die Messungen der Zeitreihen betrachtet, die für alle drei Variablen vorhanden sind. Wir schaffen einen Überblick über den Zusammenhang der Daten mit einem Plot.

```{r 3plot_orig, echo=FALSE, fig.cap = figNum("Überblick alle 3 Zeitreihen, Daten nach Zeit geordnet, aggregiert sich innerhalb 12 Stunden")}
dataNO3=coredata(tsAll[,'zooNO3'])
dataNetra=coredata(tsAll[,'zooRad'])
dataPrec=coredata(tsAll[,'aggPrecip'])

# library(rgl)
# plot3d(dataNO3,dataNetra,dataPrec)
#library(plot3D)
# scatter3D(dataNO3,dataNetra,dataPrec)

# maxD=max(c(dataNO3,dataNetra,dataPrec))
# minD=min(c(dataNO3,dataNetra,dataPrec))

par(mfrow=c(3,1))
plot(tsAll[,'zooRad'],ylab='Netradiation')
plot(tsAll[,'zooNO3'],ylab='NO3',col='blue')
plot(tsAll[,'aggPrecip'],ylab='Precip')
par(mfrow=c(1,1))

```

Außerdem plotten wir jeweils zwei Daten gegeneinander.

```{r pairplot_orig, echo=FALSE, fig.cap = figNum("Scatterplot der jeweiligen Datensätze, Daten aggregieren sich innerhalb 12 Stunden")}
pairs(cbind(dataNO3,dataNetra,dataPrec))

```

Hier sieht man auf den ersten Blick keinen linearen Zusammenhang zwischen den jeweiligen Daten. Daher rechnen wir die Kovarianzmatrizen mit folgenden Verfahren aus:

  - Pearsonschen Korrelationskoeffizienten misst die Korrelation zwischen zwei normalverteilten Merkmalen. Werte nahe bei 0 zeigen keinen linearen Zusammenhang.
  
  - Spearmanschen Rangkorrelationskoeffizienten ist ein nichtparametrisches, statistisches Verfahren. Es beruht auf der Vergabe von Rängen, kann daher auch auf einen nichtlinearen Zusammenhang verweisen.
  
  - Kendalls Tau berechnet die Differenz zwischen der Wahrscheinlichkeit, dass die beobachteten Daten für beide Variablen in derselben Rangfolge vorliegen und der Wahrscheinlichkeit, dass die Daten für die beiden Variablen verschiedene Rangfolgen besitzen.

Wir führen gleichzeitig noch statistische Tests für die jeweiligen Verfahren aus.
```{r cor_orig, echo=FALSE, error=FALSE, message=FALSE,warning=FALSE,fig.cap = figNum("Korvarianzanalysis, Originale Daten")}
#Packet: dbt.Plot
PlotPixMatrix(cor(cbind(dataNO3,dataNetra,dataPrec),method='pearson'), main = 'Korvarianzmatrix nach pearson')
cor.test(dataNO3,dataNetra,method='pearson')
cor.test(dataNO3,dataPrec,method='pearson')
PlotPixMatrix(cor(cbind(dataNO3,dataNetra,dataPrec),method='kendall'), main = 'Korvarianzmatrix nach kendall')
cor.test(dataNO3,dataNetra,method='kendall')
cor.test(dataNO3,dataPrec,method='kendall')
PlotPixMatrix(cor(cbind(dataNO3,dataNetra,dataPrec),method='spearman'), main = 'Korvarianzmatrix nach spearman')
cor.test(dataNO3,dataNetra,method='spearman')
cor.test(dataNO3,dataPrec,method='spearman')
```

Hier sieht man keinen deutlichen linearen oder nichtlinearen Zusammenhang zwischen den jeweilige Variablen. Trotzdem werden alle Nullhyphotesen "true correlation/tau/rho ist gleich 0" mit hoher Signifikanz abgelehnt. D.h. Netradiation und Precip haben nur sehr kleinen Einfluss auf NO3. 

***

## Transformierte Daten
Wir betrachen noch die transformierten Daten. Laut Box-cox-Transformation und der Ladder of Power werden die Daten folgendermaßen transformiert.

  - NO3: sqrt(Daten)
  
  - Netradiation: log(Daten)
  
  - Precip: log(Daten +1), um Logrithmieren der Nullen zu vermeiden.

Wir schaffen uns wie vorher einen Überblick der transformierten Zeitreihen. Dann plotten wir jeweils die Daten zwei der transformierten Variablen gegeneinander.
```{r 3dplot_trans, echo=FALSE, fig.cap = figNum("Überblick der 3 Zeitreihen, transformierte Daten aggregieren sich innerhalb 12 Stunden")}
# overviewPlot(dataNO3)
# boxcoxTrans(dataNO3)
transNO3 <- (sqrt(dataNO3))
# overviewPlot(transNO3)

# overviewPlot(dataNetra)
# boxcoxTrans(dataNetra)
transNetra <- (log(dataNetra))
# overviewPlot(transNetra)


# overviewPlot(dataPrec)
#ohneNull=dataPrec[dataPrec!=0]
#overviewPlot(ohneNull)
# boxcoxTrans(dataPrec)
transPrec=slog(dataPrec) #Nullen enthalten
# overviewPlot(transPrec)

#scatter3D(transNO3,transNetra,transPrec)

par(mfrow=c(3,1))
plot(time(tsAll[,'zooNO3']),transNetra,xlab='Zeit',ylab='Netradiation',type="l")
plot(time(tsAll[,'zooNO3']),transNO3,xlab='Zeit',ylab='NO3',col='blue',type="l")
plot(time(tsAll[,'zooNO3']),transPrec,xlab='Zeit',ylab='Precip',type="l")
par(mfrow=c(1,1))

```

  

```{r pairplot_trans, echo=FALSE, fig.cap = figNum("Scatterplot der jeweiligen Datensätze, transformierte Daten aggregieren sich innerhalb 12 Stunden")}
pairs(cbind(transNO3,transNetra,transPrec))

```

Auch hier wird kein starker Zusammenhang beobachtet. Wir berechnen die Kovarianzmatrizen mit den oben erwähnten Verfahren aus und führe statistische Tests durch.

```{r cor_orig_trans, echo=FALSE, error=FALSE, message=FALSE,warning=FALSE, fig.cap = figNum("Kovarianzanalysis, transformierte Daten")}
PlotPixMatrix(cor(cbind(transNO3,transNetra,transPrec),method='pearson'), main = 'Korvarianzmatrix nach pearson')
cor.test(transNO3,transNetra,method='pearson')
cor.test(transNO3,transPrec,method='pearson')
PlotPixMatrix(cor(cbind(transNO3,transNetra,transPrec),method='kendall'), main = 'Korvarianzmatrix nach kendall')
cor.test(transNO3,transNetra,method='kendall')
cor.test(transNO3,transPrec,method='kendall')
PlotPixMatrix(cor(cbind(transNO3,transNetra,transPrec),method='spearman'), main = 'Korvarianzmatrix nach spearman')
cor.test(transNO3,transNetra,method='spearman')
cor.test(transNO3,transPrec,method='spearman')
```

Wie in den nicht transformierten Daten wird hier nur ein minimaler Zusammenhang zwischen NO3 und Netradiation gefunden. Den statistischen Tests nach zu urteilen, ist die Kovarianz ungleich Null, jedoch zeigt diese nur sehr leichten Einfluss von Netradiation und Precip auf NO3, wobei der Einfluss von Netradiation größer als bei Precip ist.












